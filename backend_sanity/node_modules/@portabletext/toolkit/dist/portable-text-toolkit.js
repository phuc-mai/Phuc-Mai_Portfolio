"use strict";function e(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function t(t){for(var n=1;n<arguments.length;n++){var i=null!=arguments[n]?arguments[n]:{};n%2?e(Object(i),!0).forEach((function(e){r(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):e(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function r(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function n(e){return"span"===e._type&&"text"in e&&"string"==typeof e.text&&(void 0===e.marks||Array.isArray(e.marks)&&e.marks.every((e=>"string"==typeof e)))}function i(e){return"string"==typeof e._type&&"@"!==e._type[0]&&(!("markDefs"in e)||Array.isArray(e.markDefs)&&e.markDefs.every((e=>"string"==typeof e._key)))&&"children"in e&&Array.isArray(e.children)&&e.children.every((e=>"object"==typeof e&&"_type"in e))}function l(e){return i(e)&&"listItem"in e&&"string"==typeof e.listItem&&(void 0===e.level||"number"==typeof e.level)}function o(e){return"@list"===e._type}function s(e){return"@span"===e._type}function c(e){return"@text"===e._type}Object.defineProperty(exports,"__esModule",{value:!0});const f=["strong","em","code","underline","strike-through"];function u(e,t,r){if(!n(e)||!e.marks)return[];if(!e.marks.length)return[];const i=e.marks.slice(),l={};return i.forEach((e=>{l[e]=1;for(let i=t+1;i<r.length;i++){const t=r[i];if(!(t&&n(t)&&Array.isArray(t.marks)&&-1!==t.marks.indexOf(e)))break;l[e]++}})),i.sort(((e,t)=>function(e,t,r){const n=e[t],i=e[r];if(n!==i)return i-n;const l=f.indexOf(t),o=f.indexOf(r);if(l!==o)return l-o;return t.localeCompare(r)}(l,e,t)))}function p(e,t){return(e.level||1)===t.level&&e.listItem===t.listItem}function a(e,t,r){return{_type:"@list",_key:"".concat(e._key||"".concat(t),"-parent"),mode:r,level:e.level||1,listItem:e.listItem,children:[e]}}function h(e,t){const r=t.level||1,i=t.listItem||"normal",l="string"==typeof t.listItem;if(o(e)&&(e.level||1)===r&&l&&(e.listItem||"normal")===i)return e;if(!("children"in e))return;const s=e.children[e.children.length-1];return s&&!n(s)?h(s,t):void 0}const y=/^\s/,d=/^\s/;exports.LIST_NEST_MODE_DIRECT="direct",exports.LIST_NEST_MODE_HTML="html",exports.buildMarksTree=function(e){var t;const{children:r,markDefs:i=[]}=e;if(!r||!r.length)return[];const l=r.map(u),o={_type:"@span",children:[],markType:"<unknown>"};let s=[o];for(let e=0;e<r.length;e++){const o=r[e];if(!o)continue;const c=l[e]||[];let f=1;if(s.length>1)for(;f<s.length;f++){const e=(null==(t=s[f])?void 0:t.markKey)||"",r=c.indexOf(e);if(-1===r)break;c.splice(r,1)}s=s.slice(0,f);let u=s[s.length-1];if(u){for(const e of c){const t=i.find((t=>t._key===e)),r=t?t._type:e,n={_type:"@span",_key:o._key,children:[],markDef:t,markType:r,markKey:e};u.children.push(n),s.push(n),u=n}if(n(o)){const e=o.text.split("\n");for(let t=e.length;t-- >1;)e.splice(t,0,"\n");u.children=u.children.concat(e.map((e=>({_type:"@text",text:e}))))}else u.children=u.children.concat(o)}}return o.children},exports.isPortableTextBlock=i,exports.isPortableTextListItemBlock=l,exports.isPortableTextSpan=n,exports.isPortableTextToolkitList=o,exports.isPortableTextToolkitSpan=s,exports.isPortableTextToolkitTextNode=c,exports.nestLists=function(e,r){const n=[];let i;for(let o=0;o<e.length;o++){const s=e[o];if(s)if(l(s))if(i)if(p(s,i))i.children.push(s);else if((s.level||1)>i.level){const e=a(s,o,r);if("html"===r){const r=i.children[i.children.length-1],n=t(t({},r),{},{children:[...r.children,e]});i.children[i.children.length-1]=n}else i.children.push(e);i=e}else if((s.level||1)<i.level){const e=n[n.length-1],t=e&&h(e,s);if(t){i=t,i.children.push(s);continue}i=a(s,o,r),n.push(i)}else if(s.listItem===i.listItem)console.warn("Unknown state encountered for block",s),n.push(s);else{const e=n[n.length-1],t=e&&h(e,{level:s.level||1});if(t&&t.listItem===s.listItem){i=t,i.children.push(s);continue}i=a(s,o,r),n.push(i)}else i=a(s,o,r),n.push(i);else n.push(s),i=void 0}return n},exports.sortMarksByOccurences=u,exports.spanToPlainText=function e(t){let r="";return t.children.forEach((t=>{c(t)?r+=t.text:s(t)&&(r+=e(t))})),r},exports.toPlainText=function(e){const t=Array.isArray(e)?e:[e];let r="";return t.forEach(((e,l)=>{if(!i(e))return;let o=!1;e.children.forEach((e=>{n(e)?(r+=o&&r&&!d.test(r)&&!y.test(e.text)?" ":"",r+=e.text,o=!1):o=!0})),l!==t.length-1&&(r+="\n\n")})),r};
//# sourceMappingURL=portable-text-toolkit.js.map
